<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionale Cucina & Dieta</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Mobile optimizations */
        @media (max-width: 640px) {
            /* Larger touch targets for mobile */
            button, input, select {
                min-height: 44px;
            }

            /* Smoother scrolling on mobile */
            * {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            }
        }

        /* Hide scrollbar on tab container */
        .tab-container::-webkit-scrollbar {
            display: none;
        }
        .tab-container {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icone SVG
        const Plus = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const ShoppingCart = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
        );

        const Dice3 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8" cy="8" r="1"></circle>
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="16" cy="16" r="1"></circle>
            </svg>
        );

        const Download = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Upload = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const Edit2 = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );

        const Check = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        const X = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Copy = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        );

        const Clipboard = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
            </svg>
        );

        function CucinaApp() {
            const [activeTab, setActiveTab] = useState('ricette');
            const [ricette, setRicette] = useState([]);
            const [ingredientiDB, setIngredientiDB] = useState([]);
            const [inventario, setInventario] = useState([]);
            const [listaSpesa, setListaSpesa] = useState([]);
            const [pasti, setPasti] = useState([]);
            const [editingId, setEditingId] = useState(null);
            const [editingRecipeId, setEditingRecipeId] = useState(null);

            // Carica dati da localStorage all'avvio
            useEffect(() => {
                const savedData = localStorage.getItem('cucinaAppData');
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        if (data.ricette) setRicette(data.ricette);
                        if (data.ingredientiDB) setIngredientiDB(data.ingredientiDB);
                        if (data.inventario) setInventario(data.inventario);
                        if (data.listaSpesa) setListaSpesa(data.listaSpesa);
                        if (data.pasti) setPasti(data.pasti);
                    } catch (e) {
                        console.error('Errore nel caricamento dei dati:', e);
                    }
                }
            }, []);

            // Salva dati in localStorage quando cambiano
            useEffect(() => {
                const data = { ricette, ingredientiDB, inventario, listaSpesa, pasti };
                localStorage.setItem('cucinaAppData', JSON.stringify(data));
            }, [ricette, ingredientiDB, inventario, listaSpesa, pasti]);

            const [nuovaRicetta, setNuovaRicetta] = useState({
                nome: '',
                ingredienti: [{ nome: '', quantita: '', unita: 'g' }],
                istruzioni: '',
                grammiTotali: '',
                grammiPorzione: '',
                macro: { calorie: '', proteine: '', carboidrati: '', grassi: '' }
            });

            const unitaMisura = ['g', 'kg', 'ml', 'l', 'cucchiaio', 'cucchiaino', 'tazza', 'pz', 'fetta', 'spicchio'];

            const aggiungiRicetta = () => {
                if (!nuovaRicetta.nome) return;

                if (editingRecipeId) {
                    // Modalità modifica
                    setRicette(ricette.map(r =>
                        r.id === editingRecipeId
                            ? { ...r, ...nuovaRicetta, ingredienti: nuovaRicetta.ingredienti.filter(i => i.nome && i.quantita) }
                            : r
                    ));
                    setEditingRecipeId(null);
                } else {
                    // Modalità creazione
                    const ricetta = {
                        id: Date.now(),
                        ...nuovaRicetta,
                        ingredienti: nuovaRicetta.ingredienti.filter(i => i.nome && i.quantita)
                    };
                    setRicette([...ricette, ricetta]);
                }

                setNuovaRicetta({
                    nome: '',
                    ingredienti: [{ nome: '', quantita: '', unita: 'g' }],
                    istruzioni: '',
                    grammiTotali: '',
                    grammiPorzione: '',
                    macro: { calorie: '', proteine: '', carboidrati: '', grassi: '' }
                });
            };

            const modificaRicetta = (ricetta) => {
                setNuovaRicetta({
                    nome: ricetta.nome,
                    ingredienti: ricetta.ingredienti.length > 0 ? ricetta.ingredienti : [{ nome: '', quantita: '', unita: 'g' }],
                    istruzioni: ricetta.istruzioni || '',
                    grammiTotali: ricetta.grammiTotali || '',
                    grammiPorzione: ricetta.grammiPorzione || '',
                    macro: ricetta.macro
                });
                setEditingRecipeId(ricetta.id);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const annullaModificaRicetta = () => {
                setEditingRecipeId(null);
                setNuovaRicetta({
                    nome: '',
                    ingredienti: [{ nome: '', quantita: '', unita: 'g' }],
                    istruzioni: '',
                    grammiTotali: '',
                    grammiPorzione: '',
                    macro: { calorie: '', proteine: '', carboidrati: '', grassi: '' }
                });
            };

            const eliminaRicetta = (id) => {
                setRicette(ricette.filter(r => r.id !== id));
            };

            // Database Ingredienti
            const [nuovoIngredienteDB, setNuovoIngredienteDB] = useState({
                nome: '',
                unitaDefault: 'g',
                macro: { calorie: '', proteine: '', carboidrati: '', grassi: '' }
            });

            const aggiungiIngredienteDB = () => {
                if (!nuovoIngredienteDB.nome) return;

                const ingrediente = {
                    id: Date.now(),
                    ...nuovoIngredienteDB
                };

                setIngredientiDB([...ingredientiDB, ingrediente]);
                setNuovoIngredienteDB({
                    nome: '',
                    unitaDefault: 'g',
                    macro: { calorie: '', proteine: '', carboidrati: '', grassi: '' }
                });
            };

            const eliminaIngredienteDB = (id) => {
                setIngredientiDB(ingredientiDB.filter(i => i.id !== id));
            };

            const modificaIngredienteDB = (id, field, value) => {
                setIngredientiDB(ingredientiDB.map(ing =>
                    ing.id === id ? { ...ing, [field]: value } : ing
                ));
            };

            const copiaIngredientiJSON = () => {
                const ingredientiValidi = nuovaRicetta.ingredienti.filter(i => i.nome && i.quantita);
                if (ingredientiValidi.length === 0) {
                    alert('Aggiungi almeno un ingrediente prima di copiare!');
                    return;
                }

                const richiesta = {
                    richiesta: "Calcola le calorie totali e i macronutrienti (proteine, carboidrati, grassi in grammi) per 100g di piatto finito di questa ricetta. Considera che gli ingredienti crudi cambiano peso dopo la cottura. Restituisci il risultato compilando il campo 'outputJson' qui sotto con i valori per 100g di piatto finito.",
                    ricetta: {
                        nome: nuovaRicetta.nome || 'Ricetta senza nome',
                        ingredienti: ingredientiValidi,
                        istruzioni: nuovaRicetta.istruzioni || ''
                    },
                    outputJson: {
                        macro: {
                            calorie: 0,
                            proteine: 0,
                            carboidrati: 0,
                            grassi: 0
                        }
                    }
                };

                const json = JSON.stringify(richiesta, null, 2);

                navigator.clipboard.writeText(json).then(() => {
                    alert('✅ JSON copiato! Incollalo nella chat con Claude.\n\nClaude calcolerà i macro per 100g di piatto finito e restituirà il JSON già pronto da incollare nell\'app.');
                }).catch(() => {
                    alert('❌ Errore nella copia. Prova manualmente:\n\n' + json);
                });
            };

            const incollaMacroJSON = async () => {
                try {
                    const text = await navigator.clipboard.readText();
                    const data = JSON.parse(text);

                    if (data.macro && data.macro.calorie !== undefined) {
                        setNuovaRicetta({
                            ...nuovaRicetta,
                            macro: {
                                calorie: data.macro.calorie || '',
                                proteine: data.macro.proteine || '',
                                carboidrati: data.macro.carboidrati || '',
                                grassi: data.macro.grassi || ''
                            }
                        });
                        alert('✅ Macro incollati con successo!');
                    } else {
                        alert('❌ JSON non valido. Assicurati che contenga un oggetto "macro" con calorie, proteine, carboidrati e grassi.');
                    }
                } catch (e) {
                    alert('❌ Errore: ' + e.message + '\n\nIncolla un JSON valido nella forma:\n{\n  "macro": {\n    "calorie": 500,\n    "proteine": 30,\n    "carboidrati": 50,\n    "grassi": 15\n  }\n}');
                }
            };

            const aggiungiIngredienteRicetta = () => {
                setNuovaRicetta({
                    ...nuovaRicetta,
                    ingredienti: [...nuovaRicetta.ingredienti, { nome: '', quantita: '', unita: 'g' }]
                });
            };

            const rimuoviIngredienteRicetta = (index) => {
                const nuoviIng = [...nuovaRicetta.ingredienti];
                nuoviIng.splice(index, 1);
                setNuovaRicetta({ ...nuovaRicetta, ingredienti: nuoviIng });
            };

            const [nuovoItem, setNuovoItem] = useState({ nome: '', quantita: '', unita: 'g' });

            const aggiungiInventario = () => {
                if (!nuovoItem.nome || !nuovoItem.quantita) return;
                
                setInventario([...inventario, { id: Date.now(), ...nuovoItem }]);
                setNuovoItem({ nome: '', quantita: '', unita: 'g' });
            };

            const eliminaInventario = (id) => {
                setInventario(inventario.filter(i => i.id !== id));
            };

            const modificaInventario = (id, campo, valore) => {
                setInventario(inventario.map(i => 
                    i.id === id ? { ...i, [campo]: valore } : i
                ));
            };

            const [nuovoSpesa, setNuovoSpesa] = useState({ nome: '', quantita: '', unita: 'pz' });

            const aggiungiSpesa = () => {
                if (!nuovoSpesa.nome) return;
                
                setListaSpesa([...listaSpesa, { id: Date.now(), ...nuovoSpesa, comprato: false }]);
                setNuovoSpesa({ nome: '', quantita: '', unita: 'pz' });
            };

            const toggleComprato = (id) => {
                setListaSpesa(listaSpesa.map(s => 
                    s.id === id ? { ...s, comprato: !s.comprato } : s
                ));
            };

            const eliminaSpesa = (id) => {
                setListaSpesa(listaSpesa.filter(s => s.id !== id));
            };

            const generaListaSpesaDaRicetta = (ricetta) => {
                const nuoviArticoli = [];
                ricetta.ingredienti.forEach(ing => {
                    const esisteInInventario = inventario.some(i => 
                        i.nome.toLowerCase() === ing.nome.toLowerCase()
                    );
                    
                    const esisteInSpesa = listaSpesa.some(s => 
                        s.nome.toLowerCase() === ing.nome.toLowerCase()
                    );
                    
                    if (!esisteInInventario && !esisteInSpesa) {
                        nuoviArticoli.push({
                            id: Date.now() + Math.random(),
                            nome: ing.nome,
                            quantita: ing.quantita,
                            unita: ing.unita,
                            comprato: false
                        });
                    }
                });
                
                if (nuoviArticoli.length > 0) {
                    setListaSpesa([...listaSpesa, ...nuoviArticoli]);
                    alert(`Aggiunti ${nuoviArticoli.length} ingredienti alla lista spesa!`);
                } else {
                    alert('Hai già tutti gli ingredienti!');
                }
            };

            const ricettaRandom = () => {
                const ricetteFattibili = ricette.filter(ricetta => {
                    return ricetta.ingredienti.every(ing => 
                        inventario.some(inv => 
                            inv.nome.toLowerCase() === ing.nome.toLowerCase()
                        )
                    );
                });

                if (ricetteFattibili.length === 0) {
                    alert('Non hai ingredienti per nessuna ricetta! 😢');
                    return;
                }

                const random = ricetteFattibili[Math.floor(Math.random() * ricetteFattibili.length)];
                alert(`🎲 Oggi cucini: ${random.nome}!`);
            };

            const [nuovoPasto, setNuovoPasto] = useState({
                data: new Date().toISOString().split('T')[0],
                tipoPasto: 'Pranzo',
                nome: '',
                quantita: '',
                unita: 'g',
                macro: { calorie: '', proteine: '', carboidrati: '', grassi: '' },
                isRicetta: false,
                ricettaId: null
            });

            const tipiPasto = ['Colazione', 'Spuntino Mattina', 'Pranzo', 'Spuntino Pomeriggio', 'Pre-Workout', 'Post-Workout', 'Cena', 'Spuntino Sera'];

            const aggiungiPasto = () => {
                if (!nuovoPasto.nome) return;

                setPasti([...pasti, { id: Date.now(), ...nuovoPasto }]);
                setNuovoPasto({
                    data: new Date().toISOString().split('T')[0],
                    tipoPasto: nuovoPasto.tipoPasto, // Mantieni lo stesso tipo pasto
                    nome: '',
                    quantita: '',
                    unita: 'g',
                    macro: { calorie: '', proteine: '', carboidrati: '', grassi: '' },
                    isRicetta: false,
                    ricettaId: null
                });
            };

            const eliminaPasto = (id) => {
                setPasti(pasti.filter(p => p.id !== id));
            };

            const calcolaMacroDaGrammi = (ricetta, grammi) => {
                const fattore = grammi / 100;
                return {
                    calorie: Math.round(parseFloat(ricetta.macro.calorie || 0) * fattore),
                    proteine: (parseFloat(ricetta.macro.proteine || 0) * fattore).toFixed(1),
                    carboidrati: (parseFloat(ricetta.macro.carboidrati || 0) * fattore).toFixed(1),
                    grassi: (parseFloat(ricetta.macro.grassi || 0) * fattore).toFixed(1)
                };
            };

            const usaRicetta = (ricetta) => {
                // Se la ricetta ha grammiPorzione definito, usa quello come default
                const grammiDefault = ricetta.grammiPorzione || '100';
                const macroCalcolati = ricetta.grammiPorzione
                    ? calcolaMacroDaGrammi(ricetta, parseFloat(ricetta.grammiPorzione))
                    : ricetta.macro;

                setNuovoPasto({
                    ...nuovoPasto,
                    nome: ricetta.nome,
                    quantita: grammiDefault,
                    unita: 'g',
                    macro: macroCalcolati,
                    isRicetta: true,
                    ricettaId: ricetta.id
                });
                setActiveTab('tracking');
            };

            const selezionaRicettaTracking = (ricettaId) => {
                if (!ricettaId) {
                    // Reset a inserimento manuale
                    setNuovoPasto({
                        ...nuovoPasto,
                        nome: '',
                        quantita: '',
                        unita: 'g',
                        macro: { calorie: '', proteine: '', carboidrati: '', grassi: '' },
                        isRicetta: false,
                        ricettaId: null
                    });
                    return;
                }

                const ricetta = ricette.find(r => r.id === parseInt(ricettaId));
                if (!ricetta) return;

                const grammiDefault = ricetta.grammiPorzione || '100';
                const macroCalcolati = ricetta.grammiPorzione
                    ? calcolaMacroDaGrammi(ricetta, parseFloat(ricetta.grammiPorzione))
                    : ricetta.macro;

                setNuovoPasto({
                    ...nuovoPasto,
                    nome: ricetta.nome,
                    quantita: grammiDefault,
                    unita: 'g',
                    macro: macroCalcolati,
                    isRicetta: true,
                    ricettaId: ricetta.id
                });
            };

            const aggiornaQuantitaRicetta = (quantita) => {
                if (!nuovoPasto.isRicetta || !nuovoPasto.ricettaId) {
                    setNuovoPasto({ ...nuovoPasto, quantita });
                    return;
                }

                const ricetta = ricette.find(r => r.id === nuovoPasto.ricettaId);
                if (!ricetta || !quantita) {
                    setNuovoPasto({ ...nuovoPasto, quantita });
                    return;
                }

                const macroCalcolati = calcolaMacroDaGrammi(ricetta, parseFloat(quantita));
                setNuovoPasto({
                    ...nuovoPasto,
                    quantita,
                    macro: macroCalcolati
                });
            };

            const totaliGiornalieri = (data) => {
                const pastiDelGiorno = pasti.filter(p => p.data === data);
                return pastiDelGiorno.reduce((acc, p) => ({
                    calorie: acc.calorie + (parseFloat(p.macro.calorie) || 0),
                    proteine: acc.proteine + (parseFloat(p.macro.proteine) || 0),
                    carboidrati: acc.carboidrati + (parseFloat(p.macro.carboidrati) || 0),
                    grassi: acc.grassi + (parseFloat(p.macro.grassi) || 0)
                }), { calorie: 0, proteine: 0, carboidrati: 0, grassi: 0 });
            };

            const esportaDati = () => {
                const dati = { ricette, inventario, listaSpesa, pasti };
                const blob = new Blob([JSON.stringify(dati, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `cucina-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
            };

            const importaDati = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const dati = JSON.parse(event.target.result);
                        if (dati.ricette) setRicette(dati.ricette);
                        if (dati.inventario) setInventario(dati.inventario);
                        if (dati.listaSpesa) setListaSpesa(dati.listaSpesa);
                        if (dati.pasti) setPasti(dati.pasti);
                        alert('Dati importati con successo! ✅');
                    } catch (error) {
                        alert('Errore nell\'importazione del file');
                    }
                };
                reader.readAsText(file);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-orange-50 to-red-50 p-2 sm:p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-3 sm:p-6 mb-4 sm:mb-6">
                            <div className="flex flex-col gap-3">
                                <h1 className="text-2xl sm:text-3xl font-bold text-orange-600 text-center sm:text-left">🍳 Gestionale Cucina</h1>
                                <div className="flex flex-wrap gap-2 justify-center sm:justify-start">
                                    <button
                                        onClick={ricettaRandom}
                                        className="flex items-center gap-2 bg-purple-500 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-purple-600 transition text-sm sm:text-base min-h-[44px]"
                                    >
                                        <Dice3 />
                                        <span className="hidden xs:inline">Random</span>
                                    </button>
                                    <button
                                        onClick={esportaDati}
                                        className="flex items-center gap-2 bg-blue-500 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-blue-600 transition text-sm sm:text-base min-h-[44px]"
                                    >
                                        <Download />
                                        <span className="hidden xs:inline">Esporta</span>
                                    </button>
                                    <label className="flex items-center gap-2 bg-green-500 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-green-600 transition cursor-pointer text-sm sm:text-base min-h-[44px]">
                                        <Upload />
                                        <span className="hidden xs:inline">Importa</span>
                                        <input type="file" accept=".json" onChange={importaDati} className="hidden" />
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg mb-4 sm:mb-6 overflow-hidden">
                            <div className="flex overflow-x-auto tab-container border-b snap-x snap-mandatory">
                                {[
                                    { key: 'ricette', label: 'Ricette', icon: '📖' },
                                    { key: 'ingredienti', label: 'Ingredienti', icon: '🥕' },
                                    { key: 'inventario', label: 'Inventario', icon: '📦' },
                                    { key: 'spesa', label: 'Spesa', icon: '🛒' },
                                    { key: 'tracking', label: 'Tracking', icon: '📊' }
                                ].map(tab => (
                                    <button
                                        key={tab.key}
                                        onClick={() => setActiveTab(tab.key)}
                                        className={`px-3 sm:px-6 py-3 font-semibold whitespace-nowrap flex-shrink-0 min-h-[44px] transition-all snap-center flex flex-col sm:flex-row items-center gap-1 sm:gap-2 ${
                                            activeTab === tab.key
                                                ? 'border-b-3 border-orange-500 text-orange-600 bg-orange-50'
                                                : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'
                                        }`}
                                    >
                                        <span className="text-lg sm:text-base">{tab.icon}</span>
                                        <span className="text-xs sm:text-base">{tab.label}</span>
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-3 sm:p-6">
                            {activeTab === 'ricette' && (
                                <div>
                                    <h2 className="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-gray-800">Le Mie Ricette</h2>

                                    <div className="bg-orange-50 p-3 sm:p-4 rounded-lg mb-4 sm:mb-6">
                                        <div className="flex justify-between items-center mb-3">
                                            <h3 className="font-semibold text-sm sm:text-base">
                                                {editingRecipeId ? 'Modifica Ricetta' : 'Aggiungi Ricetta'}
                                            </h3>
                                            {editingRecipeId && (
                                                <button
                                                    onClick={annullaModificaRicetta}
                                                    className="text-red-600 hover:text-red-700 text-sm"
                                                >
                                                    Annulla
                                                </button>
                                            )}
                                        </div>
                                        <input
                                            type="text"
                                            placeholder="Nome ricetta"
                                            value={nuovaRicetta.nome}
                                            onChange={(e) => setNuovaRicetta({ ...nuovaRicetta, nome: e.target.value })}
                                            className="w-full p-3 border rounded mb-3 text-base"
                                        />
                                        
                                        <div className="mb-3">
                                            <label className="font-semibold block mb-2 text-sm sm:text-base">Ingredienti:</label>
                                            {nuovaRicetta.ingredienti.map((ing, idx) => (
                                                <div key={idx} className="flex flex-col sm:flex-row gap-2 mb-2">
                                                    <input
                                                        type="text"
                                                        placeholder="Nome"
                                                        value={ing.nome}
                                                        onChange={(e) => {
                                                            const nuoviIng = [...nuovaRicetta.ingredienti];
                                                            nuoviIng[idx].nome = e.target.value;
                                                            setNuovaRicetta({ ...nuovaRicetta, ingredienti: nuoviIng });
                                                        }}
                                                        className="flex-1 p-3 border rounded text-base"
                                                    />
                                                    <div className="flex gap-2">
                                                        <input
                                                            type="number"
                                                            placeholder="Qtà"
                                                            value={ing.quantita}
                                                            onChange={(e) => {
                                                                const nuoviIng = [...nuovaRicetta.ingredienti];
                                                                nuoviIng[idx].quantita = e.target.value;
                                                                setNuovaRicetta({ ...nuovaRicetta, ingredienti: nuoviIng });
                                                            }}
                                                            className="w-24 p-3 border rounded text-base"
                                                        />
                                                        <select
                                                            value={ing.unita}
                                                            onChange={(e) => {
                                                                const nuoviIng = [...nuovaRicetta.ingredienti];
                                                                nuoviIng[idx].unita = e.target.value;
                                                                setNuovaRicetta({ ...nuovaRicetta, ingredienti: nuoviIng });
                                                            }}
                                                            className="flex-1 sm:w-32 p-3 border rounded text-base"
                                                        >
                                                            {unitaMisura.map(u => <option key={u} value={u}>{u}</option>)}
                                                        </select>
                                                        {idx > 0 && (
                                                            <button
                                                                onClick={() => rimuoviIngredienteRicetta(idx)}
                                                                className="p-3 bg-red-500 text-white rounded hover:bg-red-600 min-w-[44px] min-h-[44px] flex items-center justify-center"
                                                            >
                                                                <X />
                                                            </button>
                                                        )}
                                                    </div>
                                                </div>
                                            ))}
                                            <button
                                                onClick={aggiungiIngredienteRicetta}
                                                className="text-orange-600 hover:text-orange-700 text-sm sm:text-base py-2 min-h-[44px]"
                                            >
                                                + Aggiungi ingrediente
                                            </button>
                                        </div>

                                        <div className="flex gap-2 mb-3">
                                            <button
                                                onClick={copiaIngredientiJSON}
                                                className="flex-1 flex items-center justify-center gap-2 bg-indigo-500 text-white px-3 py-2 rounded-lg hover:bg-indigo-600 transition text-sm min-h-[44px]"
                                            >
                                                <Copy />
                                                <span className="hidden sm:inline">Copia Ingredienti per AI</span>
                                                <span className="sm:hidden">Copia per AI</span>
                                            </button>
                                        </div>

                                        <textarea
                                            placeholder="Istruzioni di preparazione..."
                                            value={nuovaRicetta.istruzioni}
                                            onChange={(e) => setNuovaRicetta({ ...nuovaRicetta, istruzioni: e.target.value })}
                                            className="w-full p-3 border rounded mb-3 h-24 text-base"
                                        />

                                        <div className="grid grid-cols-2 gap-2 mb-3">
                                            <div>
                                                <label className="text-xs text-gray-600 block mb-1">Grammi totali piatto finito</label>
                                                <input
                                                    type="number"
                                                    placeholder="es. 400"
                                                    value={nuovaRicetta.grammiTotali}
                                                    onChange={(e) => setNuovaRicetta({ ...nuovaRicetta, grammiTotali: e.target.value })}
                                                    className="w-full p-3 border rounded text-base"
                                                />
                                            </div>
                                            <div>
                                                <label className="text-xs text-gray-600 block mb-1">Grammi per 1 porzione</label>
                                                <input
                                                    type="number"
                                                    placeholder="es. 200"
                                                    value={nuovaRicetta.grammiPorzione}
                                                    onChange={(e) => setNuovaRicetta({ ...nuovaRicetta, grammiPorzione: e.target.value })}
                                                    className="w-full p-3 border rounded text-base"
                                                />
                                            </div>
                                        </div>

                                        <div className="bg-blue-50 p-3 rounded mb-3 text-xs text-gray-700">
                                            <strong>ℹ️ Info:</strong> I macro inseriti sotto devono essere per <strong>100g di piatto finito</strong>. Usa il bottone "Copia per AI" per farli calcolare automaticamente da Claude.
                                        </div>

                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-3">
                                            <input
                                                type="number"
                                                placeholder="Calorie"
                                                value={nuovaRicetta.macro.calorie}
                                                onChange={(e) => setNuovaRicetta({
                                                    ...nuovaRicetta,
                                                    macro: { ...nuovaRicetta.macro, calorie: e.target.value }
                                                })}
                                                className="p-3 border rounded text-base"
                                            />
                                            <input
                                                type="number"
                                                placeholder="Proteine (g)"
                                                value={nuovaRicetta.macro.proteine}
                                                onChange={(e) => setNuovaRicetta({
                                                    ...nuovaRicetta,
                                                    macro: { ...nuovaRicetta.macro, proteine: e.target.value }
                                                })}
                                                className="p-3 border rounded text-base"
                                            />
                                            <input
                                                type="number"
                                                placeholder="Carbo (g)"
                                                value={nuovaRicetta.macro.carboidrati}
                                                onChange={(e) => setNuovaRicetta({
                                                    ...nuovaRicetta,
                                                    macro: { ...nuovaRicetta.macro, carboidrati: e.target.value }
                                                })}
                                                className="p-3 border rounded text-base"
                                            />
                                            <input
                                                type="number"
                                                placeholder="Grassi (g)"
                                                value={nuovaRicetta.macro.grassi}
                                                onChange={(e) => setNuovaRicetta({
                                                    ...nuovaRicetta,
                                                    macro: { ...nuovaRicetta.macro, grassi: e.target.value }
                                                })}
                                                className="p-3 border rounded text-base"
                                            />
                                        </div>

                                        <div className="flex gap-2 mb-3">
                                            <button
                                                onClick={incollaMacroJSON}
                                                className="flex-1 flex items-center justify-center gap-2 bg-teal-500 text-white px-3 py-2 rounded-lg hover:bg-teal-600 transition text-sm min-h-[44px]"
                                            >
                                                <Clipboard />
                                                <span className="hidden sm:inline">Incolla Macro da AI</span>
                                                <span className="sm:hidden">Incolla da AI</span>
                                            </button>
                                        </div>

                                        <button
                                            onClick={aggiungiRicetta}
                                            className="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition min-h-[44px] text-base font-semibold"
                                        >
                                            {editingRecipeId ? 'Salva Modifiche' : 'Aggiungi Ricetta'}
                                        </button>
                                    </div>

                                    <div className="space-y-3 sm:space-y-4">
                                        {ricette.map(ricetta => (
                                            <div key={ricetta.id} className="border rounded-lg p-3 sm:p-4 hover:shadow-md transition">
                                                <div className="flex flex-col sm:flex-row justify-between sm:items-start gap-2 mb-2">
                                                    <h3 className="text-lg sm:text-xl font-semibold text-gray-800">{ricetta.nome}</h3>
                                                    <div className="flex gap-2 flex-shrink-0">
                                                        <button
                                                            onClick={() => modificaRicetta(ricetta)}
                                                            className="text-amber-600 hover:text-amber-700 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center"
                                                            title="Modifica ricetta"
                                                        >
                                                            <Edit2 />
                                                        </button>
                                                        <button
                                                            onClick={() => usaRicetta(ricetta)}
                                                            className="text-green-600 hover:text-green-700 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center"
                                                            title="Usa per tracking"
                                                        >
                                                            <Plus />
                                                        </button>
                                                        <button
                                                            onClick={() => generaListaSpesaDaRicetta(ricetta)}
                                                            className="text-blue-600 hover:text-blue-700 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center"
                                                            title="Aggiungi a spesa"
                                                        >
                                                            <ShoppingCart />
                                                        </button>
                                                        <button
                                                            onClick={() => eliminaRicetta(ricetta.id)}
                                                            className="text-red-600 hover:text-red-700 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center"
                                                        >
                                                            <Trash2 />
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <div className="mb-2">
                                                    <p className="font-semibold text-sm text-gray-600">Ingredienti:</p>
                                                    <ul className="text-sm text-gray-700">
                                                        {ricetta.ingredienti.map((ing, idx) => (
                                                            <li key={idx}>• {ing.nome}: {ing.quantita} {ing.unita}</li>
                                                        ))}
                                                    </ul>
                                                </div>

                                                {ricetta.istruzioni && (
                                                    <p className="text-sm text-gray-600 mb-2">{ricetta.istruzioni}</p>
                                                )}

                                                <div className="mb-2">
                                                    <p className="text-xs text-gray-500 mb-1">Macro per 100g:</p>
                                                    <div className="flex flex-wrap gap-2 text-sm">
                                                        <span className="bg-red-100 text-red-700 px-2 py-1 rounded">
                                                            {ricetta.macro.calorie} kcal
                                                        </span>
                                                        <span className="bg-blue-100 text-blue-700 px-2 py-1 rounded">
                                                            P: {ricetta.macro.proteine}g
                                                        </span>
                                                        <span className="bg-yellow-100 text-yellow-700 px-2 py-1 rounded">
                                                            C: {ricetta.macro.carboidrati}g
                                                        </span>
                                                        <span className="bg-green-100 text-green-700 px-2 py-1 rounded">
                                                            G: {ricetta.macro.grassi}g
                                                        </span>
                                                    </div>
                                                </div>

                                                {ricetta.grammiPorzione && (
                                                    <div>
                                                        <p className="text-xs text-gray-500 mb-1">Macro per porzione ({ricetta.grammiPorzione}g):</p>
                                                        <div className="flex flex-wrap gap-2 text-sm">
                                                            {(() => {
                                                                const macroPorzione = calcolaMacroDaGrammi(ricetta, parseFloat(ricetta.grammiPorzione));
                                                                return (
                                                                    <>
                                                                        <span className="bg-red-50 text-red-600 px-2 py-1 rounded border border-red-200">
                                                                            {macroPorzione.calorie} kcal
                                                                        </span>
                                                                        <span className="bg-blue-50 text-blue-600 px-2 py-1 rounded border border-blue-200">
                                                                            P: {macroPorzione.proteine}g
                                                                        </span>
                                                                        <span className="bg-yellow-50 text-yellow-600 px-2 py-1 rounded border border-yellow-200">
                                                                            C: {macroPorzione.carboidrati}g
                                                                        </span>
                                                                        <span className="bg-green-50 text-green-600 px-2 py-1 rounded border border-green-200">
                                                                            G: {macroPorzione.grassi}g
                                                                        </span>
                                                                    </>
                                                                );
                                                            })()}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'ingredienti' && (
                                <div>
                                    <h2 className="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-gray-800">🥕 Database Ingredienti</h2>

                                    <div className="bg-teal-50 p-3 sm:p-4 rounded-lg mb-4 sm:mb-6">
                                        <h3 className="font-semibold mb-3 text-sm sm:text-base">Aggiungi Ingrediente</h3>
                                        <div className="mb-3">
                                            <input
                                                type="text"
                                                placeholder="Nome ingrediente (es. Pollo)"
                                                value={nuovoIngredienteDB.nome}
                                                onChange={(e) => setNuovoIngredienteDB({ ...nuovoIngredienteDB, nome: e.target.value })}
                                                className="w-full p-3 border rounded text-base mb-3"
                                            />
                                            <label className="text-xs text-gray-600 block mb-1">Unità di misura predefinita</label>
                                            <select
                                                value={nuovoIngredienteDB.unitaDefault}
                                                onChange={(e) => setNuovoIngredienteDB({ ...nuovoIngredienteDB, unitaDefault: e.target.value })}
                                                className="w-full p-3 border rounded text-base mb-3"
                                            >
                                                {unitaMisura.map(u => <option key={u} value={u}>{u}</option>)}
                                            </select>
                                        </div>

                                        <div className="bg-blue-50 p-3 rounded mb-3 text-xs text-gray-700">
                                            <strong>ℹ️ Info:</strong> I macro devono essere per <strong>100g/100ml</strong> dell'ingrediente.
                                        </div>

                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-3">
                                            <input
                                                type="number"
                                                placeholder="Calorie"
                                                value={nuovoIngredienteDB.macro.calorie}
                                                onChange={(e) => setNuovoIngredienteDB({
                                                    ...nuovoIngredienteDB,
                                                    macro: { ...nuovoIngredienteDB.macro, calorie: e.target.value }
                                                })}
                                                className="p-3 border rounded text-base"
                                            />
                                            <input
                                                type="number"
                                                placeholder="Proteine (g)"
                                                value={nuovoIngredienteDB.macro.proteine}
                                                onChange={(e) => setNuovoIngredienteDB({
                                                    ...nuovoIngredienteDB,
                                                    macro: { ...nuovoIngredienteDB.macro, proteine: e.target.value }
                                                })}
                                                className="p-3 border rounded text-base"
                                            />
                                            <input
                                                type="number"
                                                placeholder="Carbo (g)"
                                                value={nuovoIngredienteDB.macro.carboidrati}
                                                onChange={(e) => setNuovoIngredienteDB({
                                                    ...nuovoIngredienteDB,
                                                    macro: { ...nuovoIngredienteDB.macro, carboidrati: e.target.value }
                                                })}
                                                className="p-3 border rounded text-base"
                                            />
                                            <input
                                                type="number"
                                                placeholder="Grassi (g)"
                                                value={nuovoIngredienteDB.macro.grassi}
                                                onChange={(e) => setNuovoIngredienteDB({
                                                    ...nuovoIngredienteDB,
                                                    macro: { ...nuovoIngredienteDB.macro, grassi: e.target.value }
                                                })}
                                                className="p-3 border rounded text-base"
                                            />
                                        </div>

                                        <button
                                            onClick={aggiungiIngredienteDB}
                                            className="w-full bg-teal-500 text-white py-3 rounded-lg hover:bg-teal-600 transition min-h-[44px] text-base font-semibold"
                                        >
                                            Aggiungi al Database
                                        </button>
                                    </div>

                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                                        {ingredientiDB.map(ing => (
                                            <div key={ing.id} className="border-2 border-teal-200 rounded-lg p-3 sm:p-4 hover:shadow-md transition bg-teal-50">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div className="flex-1">
                                                        <h3 className="font-bold text-gray-800 text-base">{ing.nome}</h3>
                                                        <p className="text-xs text-gray-500">Unità: {ing.unitaDefault}</p>
                                                    </div>
                                                    <button
                                                        onClick={() => eliminaIngredienteDB(ing.id)}
                                                        className="text-red-600 hover:text-red-700 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center"
                                                    >
                                                        <Trash2 />
                                                    </button>
                                                </div>
                                                <div className="flex flex-wrap gap-1 text-xs">
                                                    <span className="bg-red-100 text-red-700 px-2 py-1 rounded">
                                                        {ing.macro.calorie} kcal
                                                    </span>
                                                    <span className="bg-blue-100 text-blue-700 px-2 py-1 rounded">
                                                        P: {ing.macro.proteine}g
                                                    </span>
                                                    <span className="bg-yellow-100 text-yellow-700 px-2 py-1 rounded">
                                                        C: {ing.macro.carboidrati}g
                                                    </span>
                                                    <span className="bg-green-100 text-green-700 px-2 py-1 rounded">
                                                        G: {ing.macro.grassi}g
                                                    </span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'inventario' && (
                                <div>
                                    <h2 className="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-gray-800">Inventario Ingredienti</h2>

                                    <div className="bg-blue-50 p-3 sm:p-4 rounded-lg mb-4 sm:mb-6 flex flex-col gap-2">
                                        <input
                                            type="text"
                                            placeholder="Nome ingrediente"
                                            value={nuovoItem.nome}
                                            onChange={(e) => setNuovoItem({ ...nuovoItem, nome: e.target.value })}
                                            className="w-full p-3 border rounded text-base"
                                        />
                                        <div className="flex gap-2">
                                            <input
                                                type="number"
                                                placeholder="Quantità"
                                                value={nuovoItem.quantita}
                                                onChange={(e) => setNuovoItem({ ...nuovoItem, quantita: e.target.value })}
                                                className="flex-1 p-3 border rounded text-base"
                                            />
                                            <select
                                                value={nuovoItem.unita}
                                                onChange={(e) => setNuovoItem({ ...nuovoItem, unita: e.target.value })}
                                                className="flex-1 p-3 border rounded text-base"
                                            >
                                                {unitaMisura.map(u => <option key={u} value={u}>{u}</option>)}
                                            </select>
                                        </div>
                                        <button
                                            onClick={aggiungiInventario}
                                            className="w-full bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition min-h-[44px] font-semibold"
                                        >
                                            Aggiungi
                                        </button>
                                    </div>

                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                                        {inventario.map(item => (
                                            <div key={item.id} className="border rounded-lg p-3 sm:p-4 hover:shadow-md transition">
                                                {editingId === item.id ? (
                                                    <div className="space-y-2">
                                                        <input
                                                            type="text"
                                                            value={item.nome}
                                                            onChange={(e) => modificaInventario(item.id, 'nome', e.target.value)}
                                                            className="w-full p-3 border rounded text-base"
                                                        />
                                                        <div className="flex gap-2">
                                                            <input
                                                                type="number"
                                                                value={item.quantita}
                                                                onChange={(e) => modificaInventario(item.id, 'quantita', e.target.value)}
                                                                className="flex-1 p-3 border rounded text-base"
                                                            />
                                                            <select
                                                                value={item.unita}
                                                                onChange={(e) => modificaInventario(item.id, 'unita', e.target.value)}
                                                                className="flex-1 p-3 border rounded text-base"
                                                            >
                                                                {unitaMisura.map(u => <option key={u} value={u}>{u}</option>)}
                                                            </select>
                                                        </div>
                                                        <button
                                                            onClick={() => setEditingId(null)}
                                                            className="w-full bg-green-500 text-white py-3 rounded hover:bg-green-600 flex items-center justify-center min-h-[44px] font-semibold"
                                                        >
                                                            <Check />
                                                        </button>
                                                    </div>
                                                ) : (
                                                    <div className="flex justify-between items-center">
                                                        <div>
                                                            <h3 className="font-semibold text-gray-800">{item.nome}</h3>
                                                            <p className="text-sm text-gray-600">{item.quantita} {item.unita}</p>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => setEditingId(item.id)}
                                                                className="text-blue-600 hover:text-blue-700 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center"
                                                            >
                                                                <Edit2 />
                                                            </button>
                                                            <button
                                                                onClick={() => eliminaInventario(item.id)}
                                                                className="text-red-600 hover:text-red-700 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center"
                                                            >
                                                                <Trash2 />
                                                            </button>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'spesa' && (
                                <div>
                                    <h2 className="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-gray-800">Lista della Spesa</h2>

                                    <div className="bg-green-50 p-3 sm:p-4 rounded-lg mb-4 sm:mb-6 flex flex-col gap-2">
                                        <input
                                            type="text"
                                            placeholder="Cosa comprare"
                                            value={nuovoSpesa.nome}
                                            onChange={(e) => setNuovoSpesa({ ...nuovoSpesa, nome: e.target.value })}
                                            className="w-full p-3 border rounded text-base"
                                        />
                                        <div className="flex gap-2">
                                            <input
                                                type="number"
                                                placeholder="Quantità"
                                                value={nuovoSpesa.quantita}
                                                onChange={(e) => setNuovoSpesa({ ...nuovoSpesa, quantita: e.target.value })}
                                                className="flex-1 p-3 border rounded text-base"
                                            />
                                            <select
                                                value={nuovoSpesa.unita}
                                                onChange={(e) => setNuovoSpesa({ ...nuovoSpesa, unita: e.target.value })}
                                                className="flex-1 p-3 border rounded text-base"
                                            >
                                                {unitaMisura.map(u => <option key={u} value={u}>{u}</option>)}
                                            </select>
                                        </div>
                                        <button
                                            onClick={aggiungiSpesa}
                                            className="w-full bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition min-h-[44px] font-semibold"
                                        >
                                            Aggiungi
                                        </button>
                                    </div>

                                    <div className="space-y-2">
                                        {listaSpesa.map(item => (
                                            <div
                                                key={item.id}
                                                className={`flex items-center justify-between p-3 sm:p-4 border rounded-lg hover:shadow-md transition ${
                                                    item.comprato ? 'bg-gray-50 opacity-60' : 'bg-white'
                                                }`}
                                            >
                                                <div className="flex items-center gap-3 flex-1 min-h-[44px]">
                                                    <input
                                                        type="checkbox"
                                                        checked={item.comprato}
                                                        onChange={() => toggleComprato(item.id)}
                                                        className="w-6 h-6 cursor-pointer flex-shrink-0"
                                                    />
                                                    <div className={item.comprato ? 'line-through text-gray-500' : ''}>
                                                        <span className="font-semibold text-sm sm:text-base">{item.nome}</span>
                                                        {item.quantita && (
                                                            <span className="text-xs sm:text-sm text-gray-600 ml-2">
                                                                ({item.quantita} {item.unita})
                                                            </span>
                                                        )}
                                                    </div>
                                                </div>
                                                <button
                                                    onClick={() => eliminaSpesa(item.id)}
                                                    className="text-red-600 hover:text-red-700 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center flex-shrink-0"
                                                >
                                                    <Trash2 />
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'tracking' && (
                                <div>
                                    <h2 className="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-gray-800">Tracking Pasti</h2>

                                    <div className="bg-purple-50 p-3 sm:p-4 rounded-lg mb-4 sm:mb-6">
                                        <h3 className="font-semibold mb-3 text-sm sm:text-base">Registra Pasto</h3>

                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 mb-3">
                                            <input
                                                type="date"
                                                value={nuovoPasto.data}
                                                onChange={(e) => setNuovoPasto({ ...nuovoPasto, data: e.target.value })}
                                                className="p-3 border rounded text-base"
                                            />
                                            <select
                                                value={nuovoPasto.tipoPasto}
                                                onChange={(e) => setNuovoPasto({ ...nuovoPasto, tipoPasto: e.target.value })}
                                                className="p-3 border rounded text-base font-semibold"
                                            >
                                                {tipiPasto.map(tipo => (
                                                    <option key={tipo} value={tipo}>{tipo}</option>
                                                ))}
                                            </select>
                                        </div>

                                        <div className="mb-3">
                                            <label className="text-xs text-gray-600 block mb-1">Scegli una ricetta (opzionale)</label>
                                            <select
                                                value={nuovoPasto.ricettaId || ''}
                                                onChange={(e) => selezionaRicettaTracking(e.target.value)}
                                                className="w-full p-3 border rounded text-base bg-white"
                                            >
                                                <option value="">Inserimento manuale</option>
                                                {ricette.map(ricetta => (
                                                    <option key={ricetta.id} value={ricetta.id}>
                                                        {ricetta.nome} {ricetta.grammiPorzione ? `(${ricetta.grammiPorzione}g)` : '(100g)'}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>

                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 mb-3">
                                            <input
                                                type="text"
                                                placeholder="Nome alimento"
                                                value={nuovoPasto.nome}
                                                onChange={(e) => setNuovoPasto({ ...nuovoPasto, nome: e.target.value })}
                                                className="p-3 border rounded text-base"
                                                disabled={nuovoPasto.isRicetta}
                                            />
                                            <div className="flex gap-2">
                                                <input
                                                    type="number"
                                                    placeholder="Quantità"
                                                    value={nuovoPasto.quantita}
                                                    onChange={(e) => aggiornaQuantitaRicetta(e.target.value)}
                                                    className="flex-1 p-3 border rounded text-base"
                                                />
                                                <select
                                                    value={nuovoPasto.unita}
                                                    onChange={(e) => setNuovoPasto({ ...nuovoPasto, unita: e.target.value })}
                                                    className="p-3 border rounded text-base"
                                                    disabled={nuovoPasto.isRicetta}
                                                >
                                                    <option value="g">g</option>
                                                    <option value="kg">kg</option>
                                                    <option value="porzione">porzione</option>
                                                    {unitaMisura.map(u => <option key={u} value={u}>{u}</option>)}
                                                </select>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-3">
                                            <input
                                                type="number"
                                                placeholder="Calorie"
                                                value={nuovoPasto.macro.calorie}
                                                onChange={(e) => setNuovoPasto({
                                                    ...nuovoPasto,
                                                    macro: { ...nuovoPasto.macro, calorie: e.target.value }
                                                })}
                                                className="p-3 border rounded text-base"
                                            />
                                            <input
                                                type="number"
                                                placeholder="Proteine (g)"
                                                value={nuovoPasto.macro.proteine}
                                                onChange={(e) => setNuovoPasto({
                                                    ...nuovoPasto,
                                                    macro: { ...nuovoPasto.macro, proteine: e.target.value }
                                                })}
                                                className="p-3 border rounded text-base"
                                            />
                                            <input
                                                type="number"
                                                placeholder="Carbo (g)"
                                                value={nuovoPasto.macro.carboidrati}
                                                onChange={(e) => setNuovoPasto({
                                                    ...nuovoPasto,
                                                    macro: { ...nuovoPasto.macro, carboidrati: e.target.value }
                                                })}
                                                className="p-3 border rounded text-base"
                                            />
                                            <input
                                                type="number"
                                                placeholder="Grassi (g)"
                                                value={nuovoPasto.macro.grassi}
                                                onChange={(e) => setNuovoPasto({
                                                    ...nuovoPasto,
                                                    macro: { ...nuovoPasto.macro, grassi: e.target.value }
                                                })}
                                                className="p-3 border rounded text-base"
                                            />
                                        </div>

                                        <button
                                            onClick={aggiungiPasto}
                                            className="w-full bg-purple-500 text-white py-3 rounded-lg hover:bg-purple-600 transition min-h-[44px] font-semibold"
                                        >
                                            Registra Pasto
                                        </button>
                                    </div>

                                    {pasti.length > 0 && (
                                        <div className="mb-4 sm:mb-6 p-3 sm:p-4 bg-gradient-to-r from-purple-100 to-pink-100 rounded-lg">
                                            <h3 className="font-semibold mb-2 text-sm sm:text-base">Totale di oggi:</h3>
                                            {(() => {
                                                const oggi = new Date().toISOString().split('T')[0];
                                                const totali = totaliGiornalieri(oggi);
                                                return (
                                                    <div className="grid grid-cols-2 sm:flex sm:flex-wrap gap-2 sm:gap-3">
                                                        <div className="bg-white px-3 py-2 rounded-lg shadow">
                                                            <span className="text-xs sm:text-sm text-gray-600">Calorie</span>
                                                            <p className="text-lg sm:text-xl font-bold text-red-600">{totali.calorie.toFixed(0)}</p>
                                                        </div>
                                                        <div className="bg-white px-3 py-2 rounded-lg shadow">
                                                            <span className="text-xs sm:text-sm text-gray-600">Proteine</span>
                                                            <p className="text-lg sm:text-xl font-bold text-blue-600">{totali.proteine.toFixed(1)}g</p>
                                                        </div>
                                                        <div className="bg-white px-3 py-2 rounded-lg shadow">
                                                            <span className="text-xs sm:text-sm text-gray-600">Carboidrati</span>
                                                            <p className="text-lg sm:text-xl font-bold text-yellow-600">{totali.carboidrati.toFixed(1)}g</p>
                                                        </div>
                                                        <div className="bg-white px-3 py-2 rounded-lg shadow">
                                                            <span className="text-xs sm:text-sm text-gray-600">Grassi</span>
                                                            <p className="text-lg sm:text-xl font-bold text-green-600">{totali.grassi.toFixed(1)}g</p>
                                                        </div>
                                                    </div>
                                                );
                                            })()}
                                        </div>
                                    )}

                                    <div className="space-y-4">
                                        {(() => {
                                            // Raggruppa i pasti per data e tipo pasto
                                            const pastiRaggruppati = {};
                                            [...pasti].reverse().forEach(pasto => {
                                                const data = pasto.data;
                                                if (!pastiRaggruppati[data]) {
                                                    pastiRaggruppati[data] = {};
                                                }
                                                const tipoPasto = pasto.tipoPasto || 'Altro';
                                                if (!pastiRaggruppati[data][tipoPasto]) {
                                                    pastiRaggruppati[data][tipoPasto] = [];
                                                }
                                                pastiRaggruppati[data][tipoPasto].push(pasto);
                                            });

                                            return Object.entries(pastiRaggruppati).map(([data, pastiPerTipo]) => (
                                                <div key={data} className="border-2 border-purple-200 rounded-lg p-3 sm:p-4 bg-white">
                                                    <h3 className="font-bold text-lg text-purple-700 mb-3">
                                                        {new Date(data + 'T00:00:00').toLocaleDateString('it-IT', { weekday: 'long', day: 'numeric', month: 'long' })}
                                                    </h3>

                                                    {Object.entries(pastiPerTipo).map(([tipoPasto, pastiDelTipo]) => (
                                                        <div key={tipoPasto} className="mb-3 last:mb-0">
                                                            <h4 className="font-semibold text-sm text-purple-600 mb-2 flex items-center gap-2">
                                                                <span className="bg-purple-100 px-2 py-1 rounded">{tipoPasto}</span>
                                                            </h4>
                                                            <div className="space-y-2 ml-0 sm:ml-4">
                                                                {pastiDelTipo.map(pasto => (
                                                                    <div key={pasto.id} className="border rounded-lg p-2 sm:p-3 bg-gray-50 hover:bg-gray-100 transition">
                                                                        <div className="flex justify-between items-start gap-2 mb-2">
                                                                            <div className="flex-1">
                                                                                <h5 className="font-semibold text-gray-800 text-sm">{pasto.nome}</h5>
                                                                                <p className="text-xs text-gray-500">
                                                                                    {pasto.quantita} {pasto.unita}
                                                                                </p>
                                                                            </div>
                                                                            <button
                                                                                onClick={() => eliminaPasto(pasto.id)}
                                                                                className="text-red-600 hover:text-red-700 p-1 min-w-[36px] min-h-[36px] flex items-center justify-center flex-shrink-0"
                                                                            >
                                                                                <Trash2 />
                                                                            </button>
                                                                        </div>
                                                                        <div className="flex flex-wrap gap-1 text-xs">
                                                                            <span className="bg-red-100 text-red-700 px-2 py-1 rounded">
                                                                                {pasto.macro.calorie} kcal
                                                                            </span>
                                                                            <span className="bg-blue-100 text-blue-700 px-2 py-1 rounded">
                                                                                P: {pasto.macro.proteine}g
                                                                            </span>
                                                                            <span className="bg-yellow-100 text-yellow-700 px-2 py-1 rounded">
                                                                                C: {pasto.macro.carboidrati}g
                                                                            </span>
                                                                            <span className="bg-green-100 text-green-700 px-2 py-1 rounded">
                                                                                G: {pasto.macro.grassi}g
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            ));
                                        })()}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<CucinaApp />, document.getElementById('root'));
    </script>
</body>
</html>